#!/bin/bash

if [ $# -lt 2  ]; then
 echo "incorrect usage"
 exit 1
fi

set -e

# Name of hopsworks project
PROJECT="$1"
shift
# {'install', 'remove', 'list'}
OP="$1"
shift
# Name of virtualenv python dependency
PACKAGES="$@"

# Load environment $PROJECT first

source <%= node.anaconda.base_dir %>/bin/activate $PROJECT

#Execute the 'op'

if [ $OP == "install" ] ; then
  <%= node.anaconda.base_dir %>/bin/conda install -q -y -n $PROJECT $PACKAGES
elif [ $OP == "remove" ] ; then
  <%= node.anaconda.base_dir %>/bin/conda remove $PACKAGES
else
    source <%= node.anaconda.base_dir %>/bin/deactivate $PROJECT
    exit -1
fi

# Deactivate environment
source <%= node.anaconda.base_dir %>/bin/deactivate $PROJECT
