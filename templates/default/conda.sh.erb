#!/bin/bash

# conda <op> -n <proj> [-c <channel> --override-channels] lib[=version]
# conda $1 -n $2 -c [$3] $4[$5]

if [[ $# -lt 4 || $# -gt 5 ]]; then
 echo "incorrect usage"
 exit 1
fi
VERSION=""
if [ $# -eq 5  ]; then
  VERSION="=${5}"
fi


PROJECT="$1"
shift
# {'install', 'remove', 'update', 'list'}
OP="$1"
shift
CHANNEL=
# default channel_alias  is http://conda.anaconda.org/.
if [ "$1" != "default" ] ; then
  CHANNEL="-c $1 --override-channels"
fi
shift
# Name of virtualenv python dependency
#PACKAGES="$@"
LIB="${1}${VERSION}"



if [ $? -ne 0 ] ; then
 exit 2
fi

res=0
if [ "$OP" == "install" ] ; then
  <%= node.anaconda.base_dir %>/bin/conda install -n $PROJECT -q -y $CHANNEL $LIB
elif [ "$OP" == "upgrade" ] ; then
  <%= node.anaconda.base_dir %>/bin/conda upgrade -n $PROJECT $CHANNEL $LIB
elif [ "$OP" == "remove" ] ; then
  <%= node.anaconda.base_dir %>/bin/conda remove -n $PROJECT $CHANNEL $LIB
else
  res=-5
fi

if [ $? -ne 0 ] ; then
  res=1
fi


exit $res
