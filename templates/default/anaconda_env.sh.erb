#!/bin/bash

if [ $# -lt 2  ]; then
 echo "incorrect usage"
 exit 1
fi

set -e

# Name of hopsworks project
PROJECT="$1"
# 'create' or 'remove'
OP="$2"

CLONE="$3"

if [ "$OP" == "install" ] ; then
    <%= node.anaconda.base_dir %>/bin/conda create -n $PROJECT -y -q
elif [ "$OP" == "list" ] ; then
    <%= node.anaconda.base_dir %>/bin/conda list -n $PROJECT --json > /tmp/${PROJECT}__conda_list.json
elif [ "$OP" == "clone" ] ; then
    <%= node.anaconda.base_dir %>/bin/conda create -n $PROJECT --clone $CLONE -y -q
elif [ "$OP" == "remove" ] ; then
    <%= node.anaconda.base_dir %>/bin/conda remove -n $PROJECT --all -y -q
    # Verify the environment has been deleted
    # Need to first make sure that projectnames are not partial names of other projectnames, else this might return a false positive (error)
    # One way would be to have environment names as follows: "projectname__" - '__' is not allowed as a sequence of chars in a projectname.
#    conda info --envs | grep $PROJECT 
else
    exit -1
fi

